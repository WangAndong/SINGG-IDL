PRO fields_gen_web, folder=folder
   filelist  = 'exptimes.dat'
   fmtv      =  '(i,f,f,f,f,f,f,f,f,f,f,f,f,f,f)'
   format1   = '(a,a,a,a,i,f)'
   format2   = '(a,a,a,a,a,a,i,f)'
   folders   = ['Run0410_n','Run0503_n','Run0603_n']
   dates     = [['01/02 Oct 04','28 Feb/01 Mar 05','20/21 Mar 06'], $
                ['02/03 Oct 04','01/02 Mar 05','21/22 Mar 06']]
   outfolder = 'html'
   IF keyword_set(folder) THEN outfolder=folder
   linenames = ['[NII] 6548','H&#945; 6563','[NII] 6584',$
                 'HeI 6678','[SII] 6716','[SII] 6731']
   ;
   ; load list of filenames
   readcol, filelist, hipassid, galid1, galid2, filename, $
     nexp, texp, format=format1, /silent
   readcol, filelist, temphi, tempga1, tempga2, tempga3, tempga4, $
     tempfile, tempnexp, temptexp, format=format2, /silent
   hipassid  = [hipassid, temphi]
   galid     = [galid1+' '+galid2, $
                tempga1+' '+tempga2+' '+tempga3+' '+tempga4]
   filename  = [filename, tempfile]
   nfiles    = n_elements(filename)
   ;
   ; sort list into hipass name order
   hipass1   = fix(strmid(hipassid, 1, 4))
   order     = sort(hipass1)
   hipassid  = hipassid(order)
   galid     = galid(order)
   filename  = filename(order)
   nexp      = nexp(order)
   texp      = texp(order)
   ;
   ; create filename strings
   fileno    = strmid(filename, 3)
   runno     = fix(strmid(fileno, 1, 1))
   nightno   = strmid(fileno, 3, 1)
   fhtml     = outfolder+'/field'+fileno+'.html'
   fhtmlps   = outfolder+'/field'+fileno+'ps.html'
   fcomb     = '../'+folders(runno-1)+nightno+'/comb'+fileno+'.dat'
   ffit      = '../'+folders(runno-1)+nightno+'/vrot'+fileno+'.dat'
   fhome     = 'html/index.html'
   fhomeps   = 'html/indexps.html'
   indexcells   = make_array(nfiles, 2, /string)
   indexline    = make_array(nfiles, /string)
   indexcellsps = make_array(nfiles, 2, /string)
   indexlineps  = make_array(nfiles, /string)
   hasfit       = make_array(nfiles, /integer)
   ;
   ; create html page for each galaxy
   FOR ii = 0, nfiles-1 DO BEGIN
       print, hipassid(ii)
       ;
       ; find out which lines are present
       readcol, fcomb(ii), apid, z1, f1, z2, f2, z3, f3, z4, f4, z5, f5, z6, f6, $
         meanz, meanv, format=fmtv, /silent
       nap        = n_elements(apid)
       zgrid      = make_array(6,nap)
       zgrid(0,*) = z1
       zgrid(1,*) = z2
       zgrid(2,*) = z3
       zgrid(3,*) = z4
       zgrid(4,*) = z5
       zgrid(5,*) = z6
       linedata   = where(total(zgrid, 2) GT 0, nlinedata)
       ;
       ; see if a fit is available, and read data if yes
       openr, 1, ffit(ii), error=openerr
       close, 1
       IF openerr EQ 0 THEN BEGIN
           hasfit(ii) = 1
           readcol, ffit(ii), col1, col2, col3, col4, format='(a,f,a,f)', /silent
           vsysloc    = where(col1 EQ 'vsys', nvsys)
           vsysloc    = vsysloc(nvsys-1)
           incloc     = where(col1 EQ 'inc', ninc)
           incloc     = incloc(ninc-1)
           params     = col2(vsysloc:vsysloc+4)
           paramserr  = col4(vsysloc:vsysloc+4)
           params(1)  = col2(incloc)
           paramserr(1) = col4(incloc)
           readcol, ffit(ii), col1, col2, col3, format='(a,a,f)', /silent
           meanloc    = where(col1 EQ 'mean', nmean)
           meanloc    = meanloc(nmean-1)
           meanerr    = col3(meanloc)
           resrms     = col3(meanloc+1)
           readcol, ffit(ii), rr, vrot, err, format='(f,f,x,f)', /silent
           rrloc      = 0
           FOR jj = 1, n_elements(rr)-1 DO IF rr(jj) LT rr(jj-1) THEN rrloc = jj
           rr         = [0.0, rr(rrloc:*)]
           vrot       = [0.0, vrot(rrloc:*)]
           err        = [0.0, err(rrloc:*)]
           nrr        = n_elements(rr)
       ENDIF
       ;
       ; make line for index page
       indexcells(ii, *)   = ''
       indexcellsps(ii, *) = ''
       FOR jj = 0, nlinedata-1 DO BEGIN
           IF indexcells(ii, 0) NE '' THEN indexcells(ii, *) = indexcells(ii, *) + ', '
           indexcells(ii, 0) = indexcells(ii, 0) + $
             '<a href="images/field' + fileno(ii) + '_' + strcompress(string(linedata(jj)+1), $
             /remove_all) + '.jpg">' + linenames(linedata(jj)) + '</a>'
           indexcells(ii, 1) = indexcells(ii, 1) + $
             '<a href="images/fieldpic' + fileno(ii) + '_' + strcompress(string(linedata(jj)+1), $
             /remove_all) + '.jpg">' + linenames(linedata(jj)) + '</a>'
           IF indexcellsps(ii, 0) NE '' THEN indexcellsps(ii, *) = indexcellsps(ii, *) + ', '
           indexcellsps(ii, 0) = indexcellsps(ii, 0) + $
             '<a href="ps/field' + fileno(ii) + '_' + strcompress(string(linedata(jj)+1), $
             /remove_all) + '.ps">' + linenames(linedata(jj)) + '</a>'
           indexcellsps(ii, 1) = indexcellsps(ii, 1) + $
             '<a href="ps/fieldpic' + fileno(ii) + '_' + strcompress(string(linedata(jj)+1), $
             /remove_all) + '.ps">' + linenames(linedata(jj)) + '</a>'
       ENDFOR 
       date          = dates(runno(ii)-1, fix(nightno(ii))-1)
       date          = date(0)
       indexline(ii) = '<tr><td><a href="field' + fileno(ii) + '.html">' + hipassid(ii) + $
         '</a></td><td>' + galid(ii) + '</td><td>' + date + $
         '</td><td><a href="images/meanvel' + fileno(ii) + '.jpg">mean</a>, ' + $
         '<a href="images/vel' + fileno(ii) + '.jpg">all</a></td><td>' + $
         '<a href="images/meanvelpic' + fileno(ii) + '.jpg">mean</a>, ' + $
         '<a href="images/velpic' + fileno(ii) + '.jpg">all</a></td><td>' + $
         indexcells(ii, 0) + $
         '</td><td>' + indexcells(ii, 1) + '</td><td><a href="images/intspec' + fileno(ii) + $
         '.jpg">plots</a>, <a href="data/intspec' + fileno(ii) + '.dat">ASCII</a></td>' + $
         '<td><a href="images/velprof' + fileno(ii) + $
         '.jpg">plot</a>, <a href="data/velprof' + fileno(ii) + '.dat">ASCII</a></td></tr>'
       indexlineps(ii) = '<tr><td><a href="field' + fileno(ii) + 'ps.html">' + hipassid(ii) + $
         '</a></td><td>' + galid(ii) + '</td><td>' + date + $
         '</td><td><a href="ps/meanvel' + fileno(ii) + '.ps">mean</a>, ' + $
         '<a href="ps/vel' + fileno(ii) + '.ps">all</a></td><td>' + $
         '<a href="ps/meanvelpic' + fileno(ii) + '.ps">mean</a>, ' + $
         '<a href="ps/velpic' + fileno(ii) + '.ps">all</a></td><td>' + $
         indexcellsps(ii, 0) + $
         '</td><td>' + indexcellsps(ii, 1) + '</td><td><a href="ps/intspec' + fileno(ii) + $
         '.ps">plots</a>, <a href="data/intspec' + fileno(ii) + '.dat">ASCII</a></td>' + $
         '<td><a href="ps/velprof' + fileno(ii) + $
         '.ps">plot</a>, <a href="data/velprof' + fileno(ii) + '.dat">ASCII</a></td></tr>'
       ;
       ; create table entries
       cells      = [[linenames], [linenames]]
       FOR jj = 0, nlinedata-1 DO BEGIN
           cells(linedata(jj),0) = $
             '<a href="images/field'+fileno(ii)+'_'+strcompress(string(linedata(jj)+1), $
             /remove_all)+'.jpg">'+cells(linedata(jj),0)+'</a>'
           cells(linedata(jj),1) = $
             '<a href="images/fieldpic'+fileno(ii)+'_'+strcompress(string(linedata(jj)+1), $
             /remove_all)+'.jpg">'+cells(linedata(jj),1)+'</a>'
       ENDFOR 
       cellsps    = [[linenames], [linenames]]
       FOR jj = 0, nlinedata-1 DO BEGIN
           cellsps(linedata(jj),0) = $
             '<a href="ps/field'+fileno(ii)+'_'+strcompress(string(linedata(jj)+1), $
             /remove_all)+'.ps">'+cellsps(linedata(jj),0)+'</a>'
           cellsps(linedata(jj),1) = $
             '<a href="ps/fieldpic'+fileno(ii)+'_'+strcompress(string(linedata(jj)+1), $
             /remove_all)+'.ps">'+cellsps(linedata(jj),1)+'</a>'
       ENDFOR 
       ;
       ; write html for jpg page
       openw, 1, fhtml(ii)
       printf, 1, '<HTML>'
       printf, 1, '<HEAD>'
       printf, 1, '<TITLE>'+hipassid(ii)+' ('+galid(ii)+')</TITLE>'
       printf, 1, '</HEAD>'
       printf, 1, ''
       printf, 1, '<BODY BGCOLOR="#FFFFFF">'
       printf, 1, ''
       printf, 1, '<P><TABLE WIDTH=100%>'
       printf, 1, '<tr><td>jpg version</td><td align=right><a href="field'+fileno(ii)+ $
         'ps.html">ps version</a></td></tr>'
       printf, 1, '</TABLE></P>'
       printf, 1, ''
       printf, 1, '<P>'
       printf, 1, '<img src="images/meanvelpic'+fileno(ii)+'.jpg">'
       printf, 1, '</P>'
       printf, 1, ''
       printf, 1, '<P><TABLE BORDER=1 CELLPADDING=5>'
       printf, 1, '<tr><th COLSPAN=2>Velocity Fields</th><th COLSPAN=2>Velocity, '+$
         'Flux, FWHM and Equivalent Width Fields</th></tr>'
       printf, 1, '<tr><th>Without Background Image</th><th>With Background Image</th>'+$
         '<th>Without Background Image</th><th>With Background Image</th></tr>'
       printf, 1, '<tr><td ROWSPAN=6><a href="images/meanvel'+fileno(ii)+'.jpg">mean</a>, '+$
         '<a href="images/vel'+fileno(ii)+'.jpg">all</a>'+$
         '</td><td ROWSPAN=6><a href="images/meanvelpic'+fileno(ii)+'.jpg">mean</a>, '+$
         '<a href="images/velpic'+fileno(ii)+'.jpg">all</a></td>' + $
         '<td>' + cells(0,0) + '</td><td>' + cells(0,1) + '</td></tr>'
       FOR jj = 1, 5 DO printf, 1, '<tr><td>'+cells(jj,0)+'</td><td>'+cells(jj,1)+$
         '</td></tr>'
       printf, 1, '</TABLE></P>'
       printf, 1, ''
       printf, 1, '<P><TABLE BORDER=1 CELLPADDING=5>'
       printf, 1, '<tr><th>Plots</th><th>ASCII</th></tr>'
       printf, 1, '<tr><td><a href="images/intspec'+fileno(ii)+'.jpg">' + $
         'Integrated spectra</a></td><td><a href="data/intspec'+fileno(ii)+$
         '.dat">Integrated spectra</a></td></tr>'
       printf, 1, '<tr><td><a href="images/velprof'+fileno(ii)+$
         '.jpg">H&#945; / HI velocity profiles</a></td><td><a href="data/velprof'+fileno(ii)+$
         '.dat">H&#945; / HI velocity profiles</a></td></tr>'
       printf, 1, '</TABLE></P>'
       printf, 1, ''
       printf, 1, '<P><a href="index.html">Return to index</a></P>'
       printf, 1, ''
       printf, 1, '<P><small>Page generated automatically by fields_gen_web.pro on ' + $
         systime() + '</P>'
       printf, 1, ''
       printf, 1, '</BODY>'
       printf, 1, '</HTML>'
       printf, 1, ''
       close, 1
       ;
       ; write html for ps page
       openw, 2, fhtmlps(ii)
       printf, 2, '<HTML>'
       printf, 2, '<HEAD>'
       printf, 2, '<TITLE>'+hipassid(ii)+' ('+galid(ii)+')</TITLE>'
       printf, 2, '</HEAD>'
       printf, 2, ''
       printf, 2, '<BODY BGCOLOR="#FFFFFF">'
       printf, 2, ''
       printf, 2, '<P><TABLE WIDTH=100%>'
       printf, 2, '<tr><td><a href="field'+fileno(ii)+'.html">jpg version</a></td>'+$
         '<td align=right>ps version</td></tr>'
       printf, 2, '</TABLE></P>'
       printf, 2, ''
       printf, 2, '<H2>'+hipassid(ii)+' ('+galid(ii)+')</H2>'
       printf, 2, ''
       printf, 2, '<P><TABLE BORDER=1 CELLPADDING=5>'
       printf, 2, '<tr><th COLSPAN=2>Velocity Fields</th><th COLSPAN=2>Velocity, '+$
         'Flux, FWHM and Equivalent Width Fields</th></tr>'
       printf, 2, '<tr><th>Without Background Image</th><th>With Background Image</th>'+$
         '<th>Without Background Image</th><th>With Background Image</th></tr>'
       printf, 2, '<tr><td ROWSPAN=6><a href="ps/meanvel'+fileno(ii)+'.ps">mean</a>, '+$
         '<a href="ps/vel'+fileno(ii)+'.ps">all</a>'+$
         '</td><td ROWSPAN=6><a href="ps/meanvelpic'+fileno(ii)+'.ps">mean</a>, '+$
         '<a href="ps/velpic'+fileno(ii)+'.ps">all</a></td>' + $
         '<td>' + cellsps(0,0) + '</td><td>' + cellsps(0,1) + '</td></tr>'
       FOR jj = 1, 5 DO printf, 2, '<tr><td>'+cellsps(jj,0)+'</td><td>'+cellsps(jj,1)+$
         '</td></tr>'
       printf, 2, '</TABLE></P>'
       printf, 2, ''
       printf, 2, '<P><TABLE BORDER=1 CELLPADDING=5>'
       printf, 2, '<tr><th>Plots</th><th>ASCII</th></tr>'
       printf, 2, '<tr><td><a href="ps/intspec'+fileno(ii)+'.ps">' + $
         'Integrated spectra</a></td><td><a href="data/intspec'+fileno(ii)+$
         '.dat">Integrated spectra</a></td></tr>'
       printf, 2, '<tr><td><a href="ps/velprof'+fileno(ii)+$
         '.ps">H&#945; / HI velocity profiles</a></td><td><a href="data/velprof'+fileno(ii)+$
         '.dat">H&#945; / HI velocity profiles</a></td></tr>'
       printf, 2, '</TABLE></P>'
       printf, 2, ''
       printf, 2, '<P><a href="indexps.html">Return to index</a></P>'
       printf, 2, ''
       printf, 2, '<P><small>Page generated automatically by fields_gen_web.pro on ' + $
         systime() + '</P>'
       printf, 2, ''
       printf, 2, '</BODY>'
       printf, 2, '</HTML>'
       printf, 2, ''
       close, 2
   ENDFOR 
   ;
   ; create index page for jpg pages
   openw, 3, fhome
   printf, 3, '<HTML>'
   printf, 3, '<HEAD>'
   printf, 3, '<TITLE>WIYN Sparsepak kinematics</TITLE>'
   printf, 3, '</HEAD>'
   printf, 3, ''
   printf, 3, '<BODY BGCOLOR="#FFFFFF">'
   printf, 3, ''
   printf, 3, '<P><TABLE WIDTH=100%>'
   printf, 3, '<tr><td>jpg version</td><td align=right><a href="indexps.html">'+$
     'ps version</a></td></tr>'
   printf, 3, '</TABLE></P>'
   printf, 3, ''
   printf, 3, '<P><TABLE border=1 cellpadding=3>'
   printf, 3, '<tr><th ROWSPAN=2>HIPASS Name</th><th ROWSPAN=2>Optical ID</th>'+$
     '<th ROWSPAN=2>Date Observed</th><th COLSPAN=2>Velocity Fields</th>'+$
     '<th COLSPAN=2>Velocity, Flux, FWHM and Equivalent Width Fields</th>'+$
     '<th ROWSPAN=2>Integrated Spectra</th>'+$
     '<th ROWSPAN=2>H&#945; / HI Velocity Profiles</th></tr>'
   printf, 3, '<tr><th>Without Background Image</th><th>With Background Image</th>'+$
     '<th>Without Background Image</th><th>With Background Image</th></tr>'
   FOR ii = 0, nfiles-1 DO printf, 3, indexline(ii)
   printf, 3, '</TABLE></P>'
   printf, 3, ''
   printf, 3, '<P><TABLE cellpadding=3>'
   printf, 3, '<tr><th COLSPAN=2>Other plots</th></tr>'
   printf, 3, '<tr><td><a href="images/widths50.jpg">H&#945; / HI linewidths ' +$
     '(W<sub>50</sub>)</a></td><td><a href="data/widths50.dat">ASCII</a></td></tr>'
   printf, 3, '<tr><td><a href="images/widths20.jpg">H&#945; / HI linewidths ' +$
     '(W<sub>20</sub>)</a></td><td><a href="data/widths20.dat">ASCII</a></td></tr>'
   printf, 3, '<tr><td><a href="images/rmag_lineratio.jpg">R band magnitude / linewidth ' +$
     'ratio correlation</a></td><td><a href="data/rmag_lineratio.dat">ASCII</a></td></tr>'
   printf, 3, '</TABLE></P>'
   printf, 3, ''
   printf, 3, '<P><TABLE cellpadding=3>'
   printf, 3, '<tr><th COLSPAN=2>Documentation</th></tr>'
   printf, 3, '<tr><td><a href="docs/irafreport.ps">Extracting multiple spectra in IRAF' + $
     '</a></td><td><a href="docs/irafreport.tex">latex</a></td></tr>'
   printf, 3, '<tr><td><a href="docs/idlreport.ps">IDL plotting of velocity fields and ' + $
     'related data</a></td><td><a href="docs/idlreport.tex">latex</a></td></tr>'
   printf, 3, '</TABLE></P>'
   printf, 3, ''
   printf, 3, '<P><small>Page generated automatically by fields_gen_web.pro on ' + $
     systime() + '</P>'
   printf, 3, ''
   printf, 3, '</BODY>'
   printf, 3, '</HTML>'
   close, 3
   ;
   ; create index page for ps pages
   openw, 4, fhomeps
   printf, 4, '<HTML>'
   printf, 4, '<HEAD>'
   printf, 4, '<TITLE>WIYN Sparsepak kinematics</TITLE>'
   printf, 4, '</HEAD>'
   printf, 4, ''
   printf, 4, '<BODY BGCOLOR="#FFFFFF">'
   printf, 4, ''
   printf, 4, '<P><TABLE WIDTH=100%>'
   printf, 4, '<tr><td><a href="index.html">jpg version</a></td><td align=right>'+$
     'ps version</td></tr>'
   printf, 4, '</TABLE></P>'
   printf, 4, ''
   printf, 4, '<P><TABLE border=1 cellpadding=3>'
   printf, 4, '<tr><th ROWSPAN=2>HIPASS Name</th><th ROWSPAN=2>Optical ID</th>'+$
     '<th ROWSPAN=2>Date Observed</th><th COLSPAN=2>Velocity Fields</th>'+$
     '<th COLSPAN=2>Velocity, Flux, FWHM and Equivalent Width Fields</th>'+$
     '<th ROWSPAN=2>Integrated Spectra</th>'+$
     '<th ROWSPAN=2>H&#945; / HI Velocity Profiles</th></tr>'
   printf, 4, '<tr><th>Without Background Image</th><th>With Background Image</th>'+$
     '<th>Without Background Image</th><th>With Background Image</th></tr>'
   FOR ii = 0, nfiles-1 DO printf, 4, indexlineps(ii)
   printf, 4, '</TABLE></P>'
   printf, 4, ''
   printf, 4, '<P><TABLE cellpadding=3>'
   printf, 4, '<tr><th COLSPAN=2>Other plots</th></tr>'
   printf, 4, '<tr><td><a href="ps/widths50.ps">H&#945; / HI linewidths ' +$
     '(W<sub>50</sub>)</a></td><td><a href="data/widths50.dat">ASCII</a></td></tr>'
   printf, 4, '<tr><td><a href="ps/widths20.ps">H&#945; / HI linewidths ' +$
     '(W<sub>20</sub>)</a></td><td><a href="data/widths20.dat">ASCII</a></td></tr>'
   printf, 4, '<tr><td><a href="ps/rmag_lineratio.ps">R band magnitude / linewidth ' +$
     'ratio</a></td><td><a href="data/rmag_lineratio.dat">ASCII</a></td></tr>'
   printf, 4, '</TABLE></P>'
   printf, 4, ''
   printf, 4, '<P><TABLE cellpadding=3>'
   printf, 4, '<tr><th COLSPAN=2>Documentation</th></tr>'
   printf, 4, '<tr><td><a href="docs/irafreport.ps">Extracting multiple spectra in IRAF' + $
     '</a></td><td><a href="docs/irafreport.tex">latex</a></td></tr>'
   printf, 4, '<tr><td><a href="docs/idlreport.ps">IDL plotting of velocity fields and ' + $
     'related data</a></td><td><a href="docs/idlreport.tex">latex</a></td></tr>'
   printf, 4, '</TABLE></P>'
   printf, 4, ''
   printf, 4, '<P><small>Page generated automatically by fields_gen_web.pro on ' + $
     systime() + '</P>'
   printf, 4, ''
   printf, 4, '</BODY>'
   printf, 4, '</HTML>'
   close, 4


END
